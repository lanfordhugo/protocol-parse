---
name: python-test-review
description: Use when reviewing Python test code quality, debugging flaky tests, checking test coverage, verifying assertion quality, or auditing test reliability. Covers pytest, unittest, nose2 frameworks, mock usage, FIRST principles, AAA pattern, dependency isolation, and Python testing ecosystem best practices
---

# Reviewing Python Test Code

## Overview

Python æµ‹è¯•ä»£ç å®¡æŸ¥æŠ€èƒ½ä¸“æ³¨äº**ç¡®ä¿æµ‹è¯•çš„å¯ä¿¡åº¦å’Œå¯ç»´æŠ¤æ€§**ã€‚

**æ ¸å¿ƒæ–¹æ³•è®ºï¼šå…­ç»´å®¡æŸ¥æ³•** - ä»éœ€æ±‚è¦†ç›–ã€æµ‹è¯•ç»“æ„ã€æ–­è¨€è´¨é‡ã€ä¾èµ–éš”ç¦»ã€FIRST åŸåˆ™ã€æ¡†æ¶è§„èŒƒ 6 ä¸ªç»´åº¦å…¨é¢è¯„ä¼°æµ‹è¯•è´¨é‡ã€‚

**æ ¸å¿ƒåŸåˆ™ï¼š**

1. **ä¸šåŠ¡ä»·å€¼ä¼˜å…ˆ** - æµ‹è¯•å¿…é¡»ä¿æŠ¤å…³é”®ä¸šåŠ¡éœ€æ±‚
2. **çœŸå®æ€§éªŒè¯** - æµ‹è¯•åº”åœ¨ä»£ç æœ‰ç¼ºé™·æ—¶å¤±è´¥
3. **å¯è¯»æ€§è‡³ä¸Š** - æµ‹è¯•ä»£ç åº”æ¯”å®ç°ä»£ç æ›´ç®€å•
4. **Python ç”Ÿæ€** - éµå¾ª pytest/unittest ç¤¾åŒºæœ€ä½³å®è·µ

## When to Use

âœ… **ä½¿ç”¨åœºæ™¯ï¼š**

- å®¡æŸ¥åŒ…å«æµ‹è¯•ä»£ç çš„ PR
- éªŒè¯æµ‹è¯•è´¨é‡å‰åˆå¹¶åˆ°ä¸»åˆ†æ”¯
- å®¡è®¡ç°æœ‰æµ‹è¯•å¥—ä»¶çš„å¯é æ€§
- è°ƒè¯•ä¸ç¨³å®šæˆ–ä¸å¯é çš„æµ‹è¯•
- ä¸ºæ–°é¡¹ç›®å»ºç«‹æµ‹è¯•æ ‡å‡†
- å¼€å‘è€…å…¥èŒ Python æµ‹è¯•æœ€ä½³å®è·µ

âŒ **ä¸é€‚ç”¨äºï¼š**

- ç¼–å†™æ–°æµ‹è¯•ï¼ˆä½¿ç”¨ `python-testing` æŠ€èƒ½ï¼‰
- å®¡æŸ¥ç”Ÿäº§ä»£ç ï¼ˆä½¿ç”¨ `python-code-review` æŠ€èƒ½ï¼‰
- æ€§èƒ½æµ‹è¯•æˆ–è´Ÿè½½æµ‹è¯•åœºæ™¯

## Quick Reference

| ç±»åˆ« | å…³é”®æ£€æŸ¥ | ä¸¥é‡ç¨‹åº¦ |
| :--- | :--- | :--- |
| **è¦†ç›–ç‡** | æ ¸å¿ƒé€»è¾‘ â‰¥90%ï¼Œåˆ†æ”¯ â‰¥80% | ğŸ”´ ä¸¥é‡ |
| **AAA æ¨¡å¼** | Arrange-Act-Assert ç»“æ„ | ğŸ”´ ä¸¥é‡ |
| **æ–­è¨€** | å…·ä½“ã€æœ€å°åŒ–ã€æ¯ä¸ªæµ‹è¯•ä¸€ä¸ª | ğŸŸ¡ é«˜ |
| **Mock ä½¿ç”¨** | çŠ¶æ€éªŒè¯ > è¡Œä¸ºéªŒè¯ | ğŸŸ¡ é«˜ |
| **FIRST** | Fast, Independent, Repeatable, Self-Validating, Timely | ğŸŸ¡ é«˜ |
| **å‘½å** | `test_<function>_<condition>_<expected>` | ğŸŸ¢ ä¸­ |

è¯¦è§ [checklist.md](checklist.md) è·å–å®Œæ•´æ£€æŸ¥æ¸…å•ã€‚

## Review Workflow

```dot
digraph test_review_workflow {
    "æµ‹è¯•ä»£ç å˜æ›´" [shape=box];
    "æ‰§è¡Œæµ‹è¯•?" [shape=diamond];
    "æ‰§è¡Œå…­ç»´å®¡æŸ¥" [shape=box];
    "å‘ç°é—®é¢˜?" [shape=diamond];
    "ä¿®å¤æµ‹è¯•" [shape=box];
    "é€šè¿‡å®¡æŸ¥" [shape=box];
    "åˆå¹¶ä»£ç " [shape=box];

    "æµ‹è¯•ä»£ç å˜æ›´" -> "æ‰§è¡Œæµ‹è¯•?";
    "æ‰§è¡Œæµ‹è¯•?" -> "æ‰§è¡Œå…­ç»´å®¡æŸ¥" [label="é€šè¿‡"];
    "æ‰§è¡Œå…­ç»´å®¡æŸ¥" -> "å‘ç°é—®é¢˜?";
    "å‘ç°é—®é¢˜?" -> "ä¿®å¤æµ‹è¯•" [label="æ˜¯"];
    "ä¿®å¤æµ‹è¯•" -> "æ‰§è¡Œæµ‹è¯•?";
    "å‘ç°é—®é¢˜?" -> "é€šè¿‡å®¡æŸ¥" [label="å¦"];
    "é€šè¿‡å®¡æŸ¥" -> "åˆå¹¶ä»£ç ";
}
```

## Coverage Standards

| ä»£ç ç±»å‹ | ç›®æ ‡è¦†ç›–ç‡ |
| :--- | :--- |
| æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ | > 90% |
| å·¥å…·/è¾…åŠ©å‡½æ•° | > 80% |
| åˆ†æ”¯è¦†ç›–ç‡ | > 80% |
| **æ•´ä½“è¦†ç›–ç‡** | **> 85%** |

**è¦†ç›–ç‡ä¸èƒ½ä¿è¯ï¼š**

- âŒ æµ‹è¯•è´¨é‡ï¼ˆé€šè¿‡çš„æµ‹è¯•ä¸ç­‰äºå¥½æµ‹è¯•ï¼‰
- âŒ è¾¹ç•Œæ¡ä»¶è¦†ç›–ï¼ˆ100% è¦†ç›–ç‡ä¹Ÿå¯èƒ½é—æ¼è¾¹ç•Œï¼‰
- âŒ ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§ï¼ˆéªŒè¯çš„æ˜¯ä»£ç è·¯å¾„ï¼Œéä¸šåŠ¡éœ€æ±‚ï¼‰
- âŒ å¼‚å¸¸åœºæ™¯å¤„ç†ï¼ˆæ­£å¸¸è·¯å¾„è¦†ç›–ä¸ä»£è¡¨å¼‚å¸¸å¤„ç†æ­£ç¡®ï¼‰

## Review Tools

**æµ‹è¯•è´¨é‡æ£€æŸ¥ï¼š**

```bash
# è¿è¡Œæµ‹è¯•å¹¶æ£€æŸ¥è¦†ç›–ç‡
pytest --cov=src --cov-report=html --cov-report=term-missing

# æ£€æŸ¥æµ‹è¯•ä»£ç è´¨é‡
pytest --flake8 --pylint

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
pytest --html=report.html --self-contained-html

# æ ‡è®°æ…¢é€Ÿæµ‹è¯•
pytest -m "not slow" -v
```

**Mock éªŒè¯ï¼š**

```bash
# æ£€æŸ¥ mock ä½¿ç”¨
pytest --mock-trace
```

## Detailed References

**å®Œæ•´æ£€æŸ¥æ¸…å•ï¼š**

- **[checklist.md](checklist.md)** - å…­ç»´å®¡æŸ¥æ³•çš„å®Œæ•´æ£€æŸ¥æ¸…å•ï¼ˆ150+ é¡¹ï¼‰

**æµ‹è¯•æ¨¡å¼ï¼š**

- **[AAA Pattern](references/patterns.md)** - Arrange-Act-Assert æµ‹è¯•ç»“æ„
- **[FIRST Principles](references/first.md)** - Fast, Independent, Repeatable, Self-Validating, Timely
- **[Pytest Best Practices](references/pytest.md)** - pytest æ¡†æ¶æœ€ä½³å®è·µ

## Common Mistakes

| é”™è¯¯ | åæœ | ä¿®æ­£ |
| :--- | :--- | :--- |
| æµ‹è¯•å®ç°ç»†èŠ‚è€Œéè¡Œä¸º | è„†å¼±æµ‹è¯•ï¼Œé‡æ„æ—¶å¤±è´¥ | èšç„¦å…¬å…±æ¥å£å’Œå¯è§‚å¯Ÿè¡Œä¸º |
| è¿‡åº¦ Mock å¯¼è‡´æµ‹è¯•è„†å¼± | æµ‹è¯•é€šè¿‡ä½†ä»£ç ä¸å¯ç”¨ | ä¼˜å…ˆçŠ¶æ€éªŒè¯ï¼Œå‡å°‘è¡Œä¸ºéªŒè¯ |
| æ–­è¨€è¿‡äºå®½æ³›ï¼ˆ`assert result is not None`ï¼‰ | å‡é˜³æ€§ | ä½¿ç”¨å…·ä½“çš„æ–­è¨€æ–¹æ³• |
| æµ‹è¯•é—´å…±äº«çŠ¶æ€ | é¡ºåºä¾èµ–ï¼Œéš¾ä»¥è°ƒè¯• | ä½¿ç”¨ fixture ç‹¬ç«‹ç¯å¢ƒ |
| å¿½ç•¥è¾¹ç•Œæ¡ä»¶ | ç”Ÿäº§ç¯å¢ƒå¼‚å¸¸ | æµ‹è¯• Noneã€0ã€ç©ºé›†åˆã€æå€¼ |
| é­”æ³•æ•°å­—å’Œç¡¬ç¼–ç  | å¯è¯»æ€§å·® | ä½¿ç”¨å…·åå¸¸é‡å’Œå‚æ•°åŒ– |

## Red Flags - STOP and Re-review

- "æµ‹è¯•å¤ªç®€å•ï¼Œè‚¯å®šèƒ½é€šè¿‡"
- "æˆ‘å·²ç»æ‰‹åŠ¨æµ‹è¯•è¿‡äº†"
- "å…ˆå†™ä»£ç ï¼Œå›å¤´å†è¡¥æµ‹è¯•"
- "æµ‹è¯•é€šè¿‡å°±è¡Œï¼Œä¸ç”¨ç®¡è¦†ç›–ç‡"
- "éœ€æ±‚å¾ˆæ˜ç¡®ï¼Œä¸ç”¨åˆ†æäº†"

**æ‰€æœ‰è¿™äº›éƒ½æ„å‘³ç€ï¼šåœæ­¢å½“å‰å®¡æŸ¥ï¼Œé‡æ–°éµå¾ªå®Œæ•´çš„å…­ç»´å®¡æŸ¥æµç¨‹ã€‚**

## Test Quality Examples

### âŒ Bad: æµ‹è¯•å®ç°ç»†èŠ‚

```python
def test_calculate_discount():
    result = calculate_discount(100, "vip")
    assert result._discount_rate == 0.2  # æµ‹è¯•ç§æœ‰å­—æ®µ
    assert result._final_price == 80     # è„†å¼±çš„å®ç°ç»†èŠ‚
```

### âœ… Good: æµ‹è¯•å…¬å…±è¡Œä¸º

```python
def test_user_gets_20_percent_discount_when_vip_member():
    # Arrange: å‡†å¤‡æµ‹è¯•æ•°æ®
    price = 100
    user_type = "vip"

    # Act: æ‰§è¡Œè¢«æµ‹è¡Œä¸º
    result = calculate_discount(price, user_type)

    # Assert: éªŒè¯ä¸šåŠ¡è¡Œä¸º
    assert result == 80  # VIP ç”¨æˆ·äº«å— 8 æŠ˜
```

**ä¸ºä»€ä¹ˆä¼˜ç§€ï¼š**

- âœ“ AAA ç»“æ„æ¸…æ™°
- âœ“ å‘½åè§„èŒƒï¼ˆ`test_<function>_<condition>_<expected>`ï¼‰
- âœ“ å…·ä½“æ–­è¨€ï¼ˆé `assert result is not None`ï¼‰
- âœ“ éªŒè¯ä¸šåŠ¡ä»·å€¼ï¼Œéå®ç°ç»†èŠ‚
