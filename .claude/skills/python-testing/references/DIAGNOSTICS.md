# 诊断流程

## 问题诊断优先级

### 1. 需求理解诊断 - **最高优先级**

**深入分析issue或PRD文档：**
- 功能要求、预期行为、输入输出规格
- 已实现模块的公共接口、类型提示、文档字符串
- 识别所有需要验证的功能点和边界条件

**关键问题：**
- 这个模块要解决什么问题？
- 有哪些输入边界和特殊场景？
- 错误处理应该是什么样的？
- 性能要求是什么？

### 2. 基础设施诊断

**Python环境检查：**
- `pyproject.toml` 或 `requirements.txt` 配置
- 虚拟环境是否激活
- pytest 和相关依赖是否安装

**项目结构分析：**
- 使用 `codebase_search` 分析包结构
- 模块依赖关系
- 测试文件组织方式

**依赖关系分析：**
- 导入关系图
- 接口定义
- Mock/Fixture 使用模式

### 3. 技术实现诊断

**只有在前两步充分分析后，才考虑具体的pytest测试实现**

**代码分析要点：**
- 公共API接口
- 关键算法逻辑
- 外部依赖调用
- 状态管理方式

## 充分性验证要求

**功能完整性：**
- 每个需求点都有对应测试用例
- 正常路径和异常路径都覆盖

**边界条件：**
- 输入边界（空值、极大值、极小值）
- 类型边界（类型转换、类型错误）
- 资源限制（内存、时间、并发）
- 极端情况（网络故障、文件不存在）

**异常处理：**
- 异常场景下的行为验证
- 错误消息的正确性
- 资源清理和状态恢复

**数据一致性：**
- 状态变化是否正确
- 数据处理是否完整
- 副作用是否可控
