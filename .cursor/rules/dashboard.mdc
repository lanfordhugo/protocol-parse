---
description: 
globs: 
alwaysApply: false
---
# 规则：创建史诗仪表盘 (Epic Dashboard)

## 1. 核心目标

此规则用于生成一个高级仪表盘（`dashboard.md`），旨在提供一个清晰、集中的视图，用于跟踪一个史诗（Epic）或复杂用户故事（Story）下所有关联任务（Issues）的进度、状态和依赖关系。

仪表盘的核心价值在于：

* **可视化进度：** 让用户和AI能一目了然地看到整个需求的完成情况。
* **管理依赖：** 通过拓扑排序，确保任务按正确的依赖顺序执行，避免因依赖未完成而导致的工作阻塞。
* **单一事实来源：** 成为所有Issue状态的权威引用点。

## 2. 触发时机

当一个用户故事被分解成多个Issue，并在`task_issue_review.mdc`流程评审通过后，**必须**调用此规则来创建或更新`dashboard.md`。

## 3. 生成流程

AI在执行此规则时，必须遵循以下步骤：

1. **扫描Issues：**
    * 定位到当前工作的用户故事目录（例如 `stories/story_xx/`）。
    * 递归扫描该目录下所有的 `issue-yy.md` 文件。

2. **解析元数据：**
    * 对于每一个 `issue-yy.md` 文件，提取以下关键信息：
        * **Issue ID:** 文件名或标题中的ID (e.g., `issue-01`)。
        * **标题:** Issue的标题。
        * **状态:** 从Issue文档中解析出当前状态（**ToDo**, **InProgress**, **Done**, **Blocked**）。初始状态默认为 **ToDo**。
        * **依赖项:** 解析`## 依赖关系 (Dependencies)`部分，提取其前置依赖的Issue ID列表。

3. **构建依赖图并排序：**
    * 根据所有Issues及其依赖关系，在内存中构建一个有向无环图（DAG）。
    * **必须执行拓扑排序（Topological Sort）**，生成一个线性的、无依赖冲突的Issue执行序列。这是确保AI按正确顺序执行任务的关键。

4. **生成仪表盘Markdown文件：**
    * 在故事的根目录下创建或覆盖 `dashboard.md` 文件。
    * 文件内容必须遵循以下Markdown格式：

    ```markdown
    # 史诗仪表盘: [用户故事标题]

    **最后更新时间:** [自动生成当前日期和时间]

    ## 任务概览

    | 执行顺序 | Issue ID                               | 标题             | 状态       | 依赖项     |
    |----------|----------------------------------------|------------------|------------|------------|
    | 1        | [链接到issue-xx.md]                    | [Issue 标题]     | [状态]     | [依赖项ID] |
    | 2        | [链接到issue-yy.md]                    | [Issue 标题]     | [状态]     | [依赖项ID] |
    | ...      | ...                                    | ...              | ...        | ...        |

    ```

## 4. 维护与更新

* 每次有Issue的状态发生变更（例如，从`ToDo`变为`InProgress`，或`InProgress`变为`Done`）后，**必须**重新运行此规则，以更新`dashboard.md`。
* 这确保了仪表盘始终反映项目的最新状态。
