---
description: 
globs: 
alwaysApply: false
---

# 模块逻辑文档规范 (通用)

## 描述

本规则旨在规范模块逻辑文档（通常位于模块目录下的 `docs/` 子目录中，`.md` 文件）的结构和内容，确保其一致性、全面性和可读性。AI 在生成、修改或评审这些文档时必须遵循此规范。

## 规则

1. **目标文件:** 本规则适用于项目内各模块下的逻辑文档文件（通常路径模式为 `**/docs/*.md`），这些文件旨在解释模块下各个子组件或类的内部逻辑。

2. **统一章节结构:** 所有模块逻辑文档**必须**包含以下章节，并按此顺序排列：

    1. **概述 (Overview)**
        * 简述模块/组件的核心目标及其在系统中的定位。
    2. **核心职责 (Core Responsibilities)**
        * 清晰列出模块/组件的主要功能职责。
    3. **关键数据结构与状态 (Key Data Structures & State)**
        * 列出并解释关键的内部数据成员、状态变量、枚举和数据结构。
        * **建议:** 对具有明确状态转换的组件，在此处或第 4 节使用 **Mermaid 状态图 (State Diagram)** 进行可视化。
    4. **核心处理流程与逻辑 (Core Processing Flow & Logic)**
        * 详细描述响应主要输入事件的核心处理步骤、算法或状态机逻辑。
        * **强烈建议:** 对于复杂的逻辑或流程，使用 **Mermaid 流程图 (Flowchart)** 或 **活动图 (Activity Diagram)** 进行可视化，以辅助理解，但需注意维护成本。
    5. **接口与交互 (Interfaces & Interactions)**
        * 明确模块/组件提供的对外接口（如有）。
        * 明确模块/组件依赖的其他接口。
        * 描述与其他组件的主要交互模式。
        * **强烈建议:** 对于涉及多模块/组件协作的关键交互场景，使用 **Mermaid 时序图 (Sequence Diagram)** 进行可视化，以辅助理解，但需注意维护成本。
    6. **配置依赖 (Configuration Dependencies)**
        * 列出模块/组件行为受哪些配置参数（例如来自共享的配置结构或文件）的影响。
    7. **线程安全与错误处理 (Thread Safety & Error Handling)**
        * 说明模块/组件的线程安全策略和保证。
        * 描述主要的错误处理机制和已知的边界条件。
    8. **设计考量 (Design Considerations - 可选)**
        * 讨论重要的设计决策、模式选择（如 DI）、性能考量等。
    9. **测试与集成指南 (Testing & Integration Guide)**
        * 提供单元测试建议（Mock 策略、关键测试点）。
        * 说明集成该模块/组件时的注意事项。

3. **图表要求 (Diagram Requirements):**
    * **推荐使用 Mermaid:** 嵌入的图表（流程图、时序图、状态图等）**推荐**使用 Markdown 的 Mermaid 语法实现，以提高可读性。
    * **维护成本考量:** 在决定使用图表前，应评估其带来的价值与长期维护成本。对于频繁变动或可以通过清晰文字描述的逻辑，可不使用图表。
    * **位置:** 若使用图表，应就近嵌入其对应的描述性文本所在的章节（主要在 3、4、5 节）。
    * **目的与层级:** 图表旨在辅助理解宏观逻辑或关键交互，应保持清晰、简洁，避免过度映射代码细节。

4. **内容侧重:**
    * 在遵循统一结构的前提下，允许根据模块的复杂度和特性调整各章节内容的详细程度。
    * 文档的核心目标是清晰、准确地解释模块/组件的内部工作原理和外部交互方式。**强调"为什么"和核心逻辑，而非逐行解释代码。**

5. **AI 辅助:**
    * 当被要求生成新的逻辑文档时，AI **必须** 严格按照上述章节结构进行，并在适用的情况下**建议**使用 Mermaid 图表。
    * 当被要求评审或修改现有逻辑文档时，AI **必须** 检查其是否符合本规则（包括对图表使用的合理性评估），并提出改进建议或直接进行修改以使其合规。
