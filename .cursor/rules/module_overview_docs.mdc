---
description: 
globs: 
alwaysApply: false
---
# 模块概览文档规范 (通用)

## 描述

本规则旨在规范模块级概览文档（通常位于模块目录下的 `docs/` 子目录中，建议命名为 `ModuleName_Overview.md` 或类似）的结构和内容。此类文档提供模块的宏观视图，作为理解模块架构、组件交互和设计原则的入口点，并索引到详细的组件逻辑文档。AI 在生成、修改或评审这些文档时必须遵循此规范。

## 规则

1. **目标文件:** 本规则适用于项目内各模块下的概览文档文件（通常路径模式为 `**/docs/*_Overview.md`），旨在提供模块的整体视图。

2. **文档结构:** 所有模块概览文档**必须**包含以下章节，并按此顺序排列：

    1. **概述 (Overview)**
        * **模块目标与范围:** 宏观描述整个模块的用途、解决的核心问题以及主要功能范围。
        * **关键特性:** 列出模块提供的关键功能点。
    2. **模块架构 (Module Architecture)**
        * **组件分解:** 列出构成该模块的主要子组件（类或子模块），并简要说明每个组件的核心职责。
        * **架构图:** **必须**包含一个 **Mermaid 图表** (如块状图 `graph TD;`, 组件图等) 来可视化模块内部的主要组件及其相互关系和高层依赖。
        * **核心设计原则:** 阐述贯穿整个模块的关键设计思想、架构模式（如事件驱动、分层）或技术选型（如使用的特定库、线程模型）。
    3. **核心交互与流程 (Core Interactions & Flows)**
        * 描述涉及模块内多个组件协作的关键工作流程或用例。
        * **必须**使用 **Mermaid 时序图 (Sequence Diagram)** 或 **活动图 (Activity Diagram)** 来可视化这些跨组件的关键交互场景。
    4. **对外接口与依赖 (External Interfaces & Dependencies)**
        * **提供接口 (Provided API):** 定义该模块向系统其他部分暴露的主要公共接口或服务。
        * **外部依赖 (Dependencies):** 列出该模块运行所依赖的关键外部模块、库或系统服务。
        * **(可选) 模块边界图:** 可以用 Mermaid 图表展示该模块与外部世界的交互边界。
    5. **配置说明 (Configuration)**
        * 概述模块的主要配置项及其作用。
        * 链接到相关的配置文件或配置数据结构定义。
    6. **构建与测试策略 (Build & Testing Strategy)**
        * 简述模块的构建方式（如有特殊要求）。
        * 说明模块的整体测试方法（单元测试覆盖范围、集成测试点等）。
        * 链接到主要的测试文件或执行脚本。
    7. **组件逻辑文档索引 (Component Logic Docs Index)**
        * **必须**包含一个列表，使用 mdc 链接 (`[ComponentNameLogic.md](mdc:path/to/ComponentNameLogic.md)`) 到该模块下所有详细的组件逻辑文档（遵循 [`module_logic_docs.mdc`](mdc:.cursor/rules/module_logic_docs.mdc) 规范）。此列表为读者提供深入了解细节的入口。
    8. **(可选) 设计考量与演进 (Design Considerations & Evolution)**
        * 讨论模块设计中的重要权衡。
        * 提及已知的局限性或未来可能的改进方向。

3. **与组件逻辑文档的关系:**
    * 本规则定义的概览文档是模块的顶层入口。
    * 它**必须**通过第 7 节索引并链接到遵循 [`module_logic_docs.mdc`](mdc:.cursor/rules/module_logic_docs.mdc) 规范编写的各组件详细逻辑文档。

4. **图表要求 (Diagram Requirements):**
    * **强制使用 Mermaid:** 所有嵌入的图表**必须**使用 Markdown 的 Mermaid 语法实现。
    * **位置:** 图表应就近嵌入其对应的描述性文本所在的章节。
    * **目的:** 图表旨在辅助理解宏观结构和交互，应保持适当的抽象层次。
    * **架构图设计和美化要求 (Architecture Diagram Design & Enhancement):**
        * **复杂架构图拆解:** 当模块包含超过 8-10 个主要组件时，**必须**将单一架构图拆解为多个清晰的子系统图，每个子系统聚焦特定职责领域。建议拆解方案：
            * 核心管理子系统 (管理职责和生命周期)
            * 业务线程/执行子系统 (运行时核心，如pollAcceptor等)
            * 网络通信子系统 (连接管理和数据传输)
            * 工厂/创建子系统 (对象创建和类型管理)
            * 外部依赖关系图 (模块边界和依赖关系)

        * **视觉美化要求:**
            * **Emoji 图标:** 每个组件节点**必须**包含相关的emoji图标，增强视觉识别度
            * **详细说明:** 组件节点应包含简要的功能描述，使用`<br/>`换行展示多行信息
            * **颜色分类:** 使用 Mermaid 的 `classDef` 为不同类型的组件定义颜色主题：

                ```
                classDef coreModule fill:#e3f2fd,stroke:#1976d2,stroke-width:4px,color:#000,font-weight:bold
                classDef externalModule fill:#f1f8e9,stroke:#388e3c,stroke-width:2px,color:#000
                classDef systemModule fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
                classDef networkModule fill:#fce4ec,stroke:#c2185b,stroke-width:2px,color:#000
                ```

            * **分组布局:** 使用 `subgraph` 对相关组件进行逻辑分组，提升图表结构性

        * **核心组件突出显示:**
            * **运行时核心:** 如果模块包含关键的运行时组件（如pollAcceptor、事件循环等），**必须**使用特殊样式和说明突出显示
            * **业务流程关键节点:** 标识并突出显示影响主要业务流程的关键组件
            * **架构决策体现:** 通过图表布局和样式体现重要的架构设计决策

        * **流程图细化要求:**
            * **分阶段展示:** 使用 `rect` 区块将复杂流程分为不同阶段
            * **异常处理:** 包含主要的异常处理和错误恢复路径
            * **状态变迁:** 清晰标识关键状态变化和决策点
            * **时序精确性:** 时序图应准确反映实际的调用顺序和生命周期

        * **图表质量标准:**
            * **可读性:** 确保在不同屏幕尺寸下图表内容清晰可读
            * **一致性:** 同一文档内所有图表应使用一致的样式和命名约定
            * **完整性:** 图表应涵盖组件的主要关系，避免遗漏关键依赖
            * **维护性:** 图表结构应便于后续更新和扩展

5. **AI 辅助:**
    * 当被要求生成新的模块概览文档时，AI **必须** 严格按照上述结构和图表要求进行，并确保正确链接到已存在的组件逻辑文档。
    * 当被要求评审或修改现有概览文档时，AI **必须** 检查其是否符合本规则，特别是架构图、交互图和组件索引的完整性和准确性。
    * **架构图美化义务:** AI 在创建或更新模块文档时，**必须**主动应用上述美化要求，包括但不限于：
        * 评估架构复杂度并决定是否需要拆解为子系统图
        * 为所有组件添加合适的emoji图标和详细说明
        * 应用颜色分类和分组布局
        * 突出显示核心运行时组件和关键业务节点
        * 确保流程图包含异常处理和状态变迁细节
