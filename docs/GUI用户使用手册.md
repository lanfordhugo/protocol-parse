# V8Parse GUI 用户使用手册

> **版本**: v1.0.0
> **更新日期**: 2025-01-27
> **适用程序**: main_gui.py（统一桌面应用）

---

## 📋 目录

1. [快速入门](#快速入门)
2. [界面概览](#界面概览)
3. [普通解析页面](#普通解析页面)
4. [TCP 服务端页面](#tcp-服务端页面)
5. [界面风格设置](#界面风格设置)
6. [常见问题](#常见问题)
7. [高级功能](#高级功能)

---

## 🚀 快速入门

### 启动程序

双击运行 `V8Parse.exe`（打包版本）或在命令行执行：

```bash
python main_gui.py
```

### 系统要求

- **操作系统**: Windows 10/11、macOS、Linux
- **Python 版本**: 3.7+（源码运行）
- **依赖库**: PySide6、PyYAML

### 首次使用流程

1. **选择协议** → 在左侧协议列表中选择要解析的协议（如 "sinexcel"、"v8"）
2. **选择日志** → 点击右侧 "📂 选择" 按钮，选择对应的日志文件
3. **开始解析** → 点击 "开始解析" 按钮
4. **查看结果** → 解析完成后点击 "打开输出目录" 查看结果文件

---

## 🎨 界面概览

### 主窗口布局

```
┌─────────────────────────────────────────────────────────────┐
│ 菜单栏: 文件 | 视图 | 帮助                                      │
├──────────┬──────────────────────────────────────────────────┤
│          │  ┌─────────────┬──────────────────────────────┐  │
│  侧边栏   │  │             │        协议详情              │  │
│          │  │   协议列表   ├──────────────────────────────┤  │
│ 📁 普通解析│  │             │        过滤设置              │  │
│ 🌐 TCP服务 │  │ (可搜索)    ├──────────────────────────────┤  │
│          │  │             │        操作按钮              │  │
│          │  └─────────────┴──────────────────────────────┘  │
│          │  ┌───────────────────────────────────────────┐  │
│          │  │            日志输出面板                    │  │
│          │  │   [进度条]                                 │  │
│          │  └───────────────────────────────────────────┘  │
└──────────┴──────────────────────────────────────────────────┘
│ 状态栏: 就绪                                                  │
└─────────────────────────────────────────────────────────────┘
```

### 核心组件说明

| 组件 | 功能 |
|------|------|
| **侧边栏** | 页面导航（普通解析 / TCP 服务端） |
| **协议列表** | 显示所有可用协议，支持搜索过滤 |
| **协议详情** | 显示选中协议的配置信息、日志状态、统计数据 |
| **过滤设置** | 设置命令过滤、时间范围过滤条件 |
| **操作按钮** | 开始解析、停止、验证配置等操作 |
| **日志输出** | 实时显示解析进度、警告、错误信息 |

---

## 📂 普通解析页面

普通解析页面用于批量解析已保存的日志文件，是日常使用最频繁的功能。

### 1. 协议列表面板（左侧）

#### 协议列表功能

- **自动发现**: 自动扫描 `configs/` 目录下的所有协议配置
- **状态图标**: 显示每个协议的状态
  - ✅ **绿色对勾**: 配置有效，日志已选择
  - ⚠️ **黄色警告**: 日志未选择或文件为空
  - ❌ **红色叉号**: 配置验证失败
- **文件大小**: 显示已选择日志文件的大小

#### 搜索功能

在列表顶部的搜索框中输入关键词，实时过滤协议列表：

```
搜索框: [        sinexcel       ]  ← 输入 "sinexcel" 或 "sine"
```

**搜索特性**:

- 不区分大小写
- 支持模糊匹配（输入 "v8" 可匹配 "v8"）
- 实时过滤，无需按回车

#### 选择协议

**单击** 协议项即可选中，右侧详情面板会立即更新该协议的信息。

---

### 2. 协议详情面板（右侧上）

#### 2.1 协议详情区域

显示选中协议的基本信息：

```
┌─────────────────────────────────────┐
│ 协议详情                            │
├─────────────────────────────────────┤
│ 协议名称: sinexcel                  │
│ 配置文件: configs/sinexcel/...      │
│ 配置状态: ✅ 验证通过                │
│ ─────────────────────────────────  │
│ 日志文件: D:\logs\sinexcel.log      │
│           [📂 选择]                  │
│ 日志状态: ✅ 已选择 (1.2 MB)         │
│ ─────────────────────────────────  │
│ 支持命令: 45 个                     │
│ 枚举定义: 12 个                     │
│ 自定义类型: 8 个                    │
└─────────────────────────────────────┘
```

**字段说明**:

| 字段 | 说明 |
|------|------|
| **协议名称** | 协议标识符（对应目录名） |
| **配置文件** | YAML 配置文件的完整路径 |
| **配置状态** | 自动验证配置是否有效 |
| **日志文件** | 待解析的日志文件路径 |
| **日志状态** | 显示文件是否存在、大小是否正常 |
| **支持命令** | 该协议定义的命令格式数量 |
| **枚举定义** | 枚举映射表数量 |
| **自定义类型** | 自定义数据类型数量 |

#### 2.2 选择日志文件

**步骤**:

1. 在协议列表中选中协议
2. 点击 "📂 选择" 按钮
3. 在文件对话框中选择日志文件（支持 `.log`、`.txt` 等格式）
4. 系统自动记住该协议的日志路径，下次自动恢复

**日志文件格式要求**:

```
2025-01-27 10:30:45.123  RX 0xAA 0xBB 0xCC ...
2025-01-27 10:30:46.234  TX 0xDD 0xEE 0xFF ...
```

- 每行一条报文
- 格式：`时间戳 方向 十六进制数据`
- 方向标识：`RX`（接收）或 `TX`（发送）

**提示**:

- 日志文件可以是 UTF-8 或 GBK 编码
- 空行会自动跳过
- 无效格式的行会记录到警告日志

---

### 3. 过滤设置面板（右侧中）

过滤设置允许只解析特定命令或时间范围的报文，减少无关信息。

#### 3.1 命令过滤

**功能**: 只解析指定的命令码

**操作方式**:

1. **多选下拉框**: 点击 "命令过滤" 输入框
2. **选择命令**: 勾选需要解析的命令（可多选）
3. **搜索命令**: 在下拉框顶部的搜索栏输入命令码快速定位
4. **确认选择**: 点击下拉框外部或按 ESC 关闭

```
┌─────────────────────────────────────┐
│ 命令过滤: [0x01 (应答) ▼]           │  ← 点击展开多选列表
│          [0x02 (查询) ▼]           │
│          [0x03 (设置) ▼]           │
│         [已选择 3 个命令]            │
└─────────────────────────────────────┘
```

**选择模式**:

- **全选/全不选**: 下拉框底部的 "全选" / "全不选" 按钮
- **反向选择**: 先全选，然后取消不需要的命令
- **清空选择**: 勾选 "全不选"

**提示**:

- 不选择任何命令时 = 解析所有命令（默认）
- 选择的命令越少，解析速度越快
- 命令格式：`0x01 (应答)` - 显示命令码和描述

#### 3.2 时间范围过滤

**功能**: 只解析指定时间段内的报文

##### 自动扫描时间范围（推荐）

**步骤**:

1. 点击 "📡 扫描" 按钮
2. 系统自动扫描日志文件的时间范围
3. 在弹出的对话框中查看时间范围统计
4. 点击 "应用" 自动填充时间范围

```
┌─────────────────────────────────────┐
│ 日志时间扫描结果                     │
├─────────────────────────────────────┤
│ 起始时间: 2025-01-27 08:00:00      │
│ 结束时间: 2025-01-27 18:00:00      │
│ 时间跨度: 10 小时                   │
│ 总报文数: 15,234 条                 │
│                                     │
│       [应用] [取消]                 │
└─────────────────────────────────────┘
```

**特性**:

- 智能识别多种时间格式（ISO 8601、时间戳等）
- 显示时间跨度统计
- 支持大文件快速扫描（秒级响应）

##### 手动设置时间范围

**步骤**:

1. 勾选 "启用时间过滤" 复选框
2. 点击 "开始时间" 输入框，在弹出日历中选择日期和时间
3. 点击 "结束时间" 输入框，选择结束时间
4. 确认时间范围正确

```
┌─────────────────────────────────────┐
│ ☑ 启用时间过滤                      │
│                                     │
│ 开始时间: [2025-01-27 08:00:00 📅] │  ← 点击弹出日历选择器
│ 结束时间: [2025-01-27 18:00:00 📅] │
│                                     │
│ 时间范围: 10 小时                   │  ← 自动计算时间跨度
└─────────────────────────────────────┘
```

**日历选择器功能**:

- **日期选择**: 点击日历中的日期
- **时间选择**: 使用下方的时间微调框（小时、分钟、秒）
- **快速定位**: 使用左右箭头切换月份
- **今天按钮**: 快速跳转到当天
- **清空按钮**: 清空已选择的时间

**提示**:

- 结束时间必须晚于开始时间
- 时间范围越小，解析速度越快
- 时间范围超出日志范围时只解析有效部分

##### 智能时间格式显示

时间范围会根据跨度自动调整显示格式：

| 时间跨度 | 显示格式 | 示例 |
|---------|---------|------|
| < 1 小时 | 分钟 | `23 分 45 秒` |
| 1 小时 - 24 小时 | 小时 | `10 小时 30 分` |
| 1 天 - 7 天 | 天 | `3 天 12 小时` |
| > 7 天 | 日期 | `2025-01-20 至 2025-01-27` |

---

### 4. 操作按钮面板（右侧下）

#### 按钮功能说明

```
┌─────────────────────────────────────┐
│  [开始解析]  [停止]  [验证配置]      │
│  [打开输出目录]  [清空日志]          │
└─────────────────────────────────────┘
```

| 按钮 | 功能 | 使用场景 |
|------|------|---------|
| **开始解析** | 启动解析任务 | 日志文件已选择，配置已验证 |
| **停止** | 中止正在执行的解析任务 | 解析时间过长或需要取消 |
| **验证配置** | 检查协议配置文件的语法和语义 | 修改了 YAML 配置后 |
| **打开输出目录** | 在资源管理器中打开解析结果目录 | 解析完成后查看结果 |
| **清空日志** | 清空日志输出面板的内容 | 日志过多影响查看 |

#### 开始解析

**点击后发生的事件**:

1. **预检查**:
   - 检查是否选择了协议
   - 检查日志文件是否存在且非空
   - 检查配置是否有效

2. **开始解析**:
   - 禁用 "开始解析" 按钮（防止重复点击）
   - 启用 "停止" 按钮
   - 显示进度条

3. **解析过程**:
   - 在日志面板实时输出解析信息
   - 显示解析进度（百分比）
   - 统计成功/失败/跳过的报文数

4. **解析完成**:
   - 显示统计信息
   - 恢复 "开始解析" 按钮
   - 禁用 "停止" 按钮
   - 提示打开输出目录

**解析进度示例**:

```
[INFO] 开始解析协议: sinexcel
[INFO] 日志文件: D:\logs\sinexcel.log
[INFO] 输出文件: parsed_log/parsed_sinexcel_log_2025-01-27 10-30-45.txt
[INFO] 正在解析... ████████░░░░░░░░ 45%
[INFO] 已解析: 1523/3000 条报文
[SUCCESS] 解析完成！耗时: 3.2 秒
[SUCCESS] 成功: 1500 条, 失败: 15 条, 跳过: 8 条
```

#### 停止解析

**使用场景**:

- 解析时间过长
- 发现日志文件选择错误
- 需要调整过滤条件

**点击后**:

- 立即中断解析线程
- 显示已解析的报文数
- 清理临时资源

#### 验证配置

**功能**: 检查 YAML 配置文件的正确性

**验证项**:

- ✅ YAML 语法是否正确
- ✅ 协议元数据是否完整
- ✅ 类型定义是否有效
- ✅ 枚举值是否重复
- ✅ 命令格式是否闭合
- ✅ 字段引用是否存在

**验证结果示例**:

```
[INFO] 开始验证配置: configs/sinexcel/protocol.yaml
[SUCCESS] 配置验证通过！
[INFO] - 协议名称: sinexcel
[INFO] - 版本: 1.0
[INFO] - 命令数: 45 个
[INFO] - 类型数: 8 个
[INFO] - 枚举数: 12 个
```

**错误示例**:

```
[ERROR] 配置验证失败！
[ERROR] - 第 23 行: 字段类型 "uint16" 未定义
[ERROR] - 第 45 行: 枚举值 "OFFLINE" 重复定义
[ERROR] - 第 67 行: 命令 0x01 引用了不存在的字段 "temp"
```

#### 打开输出目录

**功能**: 在系统文件管理器中打开 `parsed_log/` 目录

**输出文件命名规则**:

```
parsed_<协议名>_log_<时间戳>.txt
```

示例：

```
parsed_sinexcel_log_2025-01-27 10-30-45.txt
parsed_v8_log_2025-01-27 11-15-32.txt
```

**输出文件内容格式**:

```
==================================================
报文 #1
==================================================
时间: 2025-01-27 10:30:45.123
方向: RX (接收)
命令码: 0x01 (查询应答)
原始数据: AA BB 01 02 03 ...

解析结果:
  - 枪编号: 1
  - 电压: 220.5 V
  - 电流: 10.2 A
  - 状态: 充电中 (0x01)
  - 温度: 25.3 °C
  ...

================================================--
```

---

### 5. 日志输出面板（底部）

#### 5.1 日志级别

日志分为 4 个级别，用不同颜色标识：

| 级别 | 颜色 | 说明 | 示例 |
|------|------|------|------|
| **INFO** | 蓝色 | 一般信息 | `[INFO] 开始解析协议: sinexcel` |
| **SUCCESS** | 绿色 | 成功信息 | `[SUCCESS] 解析完成！` |
| **WARNING** | 橙色 | 警告信息 | `[WARNING] 第 123 行格式错误，已跳过` |
| **ERROR** | 红色 | 错误信息 | `[ERROR] 日志文件不存在` |

#### 5.2 进度条

显示当前解析任务的进度：

```
解析进度: [████████████░░░░░░░░░] 45%
```

**特性**:

- 实时更新进度百分比
- 显示已解析报文数 / 总报文数
- 解析完成后自动隐藏

#### 5.3 日志操作

**右键菜单**（在日志面板中右键单击）:

```
┌──────────────────┐
│ 清空日志         │  ← 清空所有日志内容
│ 全选             │  ← 选择所有日志文本
│ 复制             │  ← 复制选中的文本
│ 另存为...        │  ← 将日志保存到文件
└──────────────────┘
```

**快捷操作**:

- `Ctrl+A`: 全选日志
- `Ctrl+C`: 复制选中的日志
- `Ctrl+D`: 清空日志

---

## 🌐 TCP 服务端页面

TCP 服务端页面用于实时接收和解析网络报文，适用于在线调试和监控场景。

### 1. 服务器配置区域

```
┌──────────────────────────────────────────────────────┐
│ 服务器配置                                            │
│ 监听地址: [0.0.0.0      ]  端口: [9999   ]          │
│ 协议:      [sinexcel     ▼]  [启动服务] [停止服务]   │
│ 状态: ● 已停止                                        │
└──────────────────────────────────────────────────────┘
```

#### 配置项说明

| 字段 | 说明 | 默认值 |
|------|------|--------|
| **监听地址** | TCP 服务器绑定的 IP 地址 | `0.0.0.0`（所有网卡） |
| **端口** | TCP 监听端口（1-65535） | `9999` |
| **协议** | 选择用于解析报文的协议 | 必选 |

#### 监听地址说明

| 地址 | 说明 |
|------|------|
| `0.0.0.0` | 监听所有网卡（本机、局域网、互联网） |
| `127.0.0.1` | 仅本机访问（localhost） |
| `192.168.x.x` | 仅指定网卡（局域网） |

**提示**:

- 开发调试使用 `127.0.0.1`
- 局域网测试使用 `0.0.0.0`
- 生产环境建议指定 IP 地址

#### 协议选择

- **下拉选择**: 点击展开所有可用协议
- **可编辑**: 支持手动输入协议名称
- **自动补全**: 输入部分名称时自动提示匹配项
- **区分大小写**: 不区分（输入 "v8" 或 "V8" 都可）

```
协议输入框: [sine  ]  ← 输入 "sine" 自动提示 "sinexcel"
            └─ sinexcel ─┘
            └─ sinot ... ┘
```

#### 启动/停止服务

**启动服务**:

1. 配置监听地址、端口、协议
2. 点击 "启动服务" 按钮
3. 检查状态标签变为 "● 运行中（绿色）"
4. 等待客户端连接

**启动成功示例**:

```
[INFO] TCP 服务器已启动: 0.0.0.0:9999
[INFO] 使用协议: sinexcel
[INFO] 等待客户端连接...
```

**启动失败示例**:

```
[ERROR] 端口 9999 已被占用！
[ERROR] 请检查是否有其他程序正在使用该端口
```

**停止服务**:

1. 点击 "停止服务" 按钮
2. 断开所有已连接的客户端
3. 保存当前会话的解析结果
4. 状态标签变为 "● 已停止（灰色）"

**停止示例**:

```
[INFO] 正在停止 TCP 服务器...
[INFO] 已断开 2 个客户端连接
[INFO] 结果已保存到: tcp_output/session_20250127_103045.txt
[INFO] TCP 服务器已停止
```

---

### 2. 实时解析区域

```
┌──────────────────────────────────────────────────────┐
│ 实时解析                                              │
│ 过滤: [全部命令 ▼]  ☑ 自动滚动  [清空显示] [保存]   │
├──────────────────────────────────────────────────────┤
│ 时间戳       | 客户端  | 命令码  | 状态  | 详情       │
│ 10:30:45.123| 192.168.1.10| 0x01| ✅  | 应答        │
│ 10:30:46.234| 192.168.1.10| 0x02| ✅  | 查询        │
│ ...                                                  │
└──────────────────────────────────────────────────────┘
│ 统计: 收到: 1523 | 成功: 1500 | 失败: 23             │
└──────────────────────────────────────────────────────┘
```

#### 2.1 过滤功能

**命令过滤**:

- **全部命令**: 显示所有报文（默认）
- **指定命令**: 只显示特定命令码的报文
- **可编辑**: 支持手动输入命令码（如 `0x01`）

**使用步骤**:

1. 点击过滤下拉框
2. 选择要过滤的命令码
3. 列表自动更新，只显示匹配的报文

**搜索命令**:

在过滤下拉框中输入命令码快速定位：

```
过滤输入框: [0x0]  ← 输入 "0x0" 自动提示匹配项
            └─ 0x01 (应答) ─┘
            └─ 0x02 (查询) ─┘
            └─ 0x03 (设置) ─┘
```

#### 2.2 自动滚动

- **勾选**: 新报文到达时自动滚动到底部（默认）
- **取消**: 停留在当前位置，方便查看历史报文

**使用场景**:

- 实时监控时勾选自动滚动
- 回查历史报文时取消自动滚动

#### 2.3 清空显示

**功能**: 清空实时解析列表（不停止服务）

**快捷键**: `Ctrl+D`

**提示**: 清空显示不影响已保存的解析结果文件

#### 2.4 保存结果

**功能**: 将当前会话的所有报文保存到文件

**保存格式**:

```
tcp_output/session_<会话ID>.txt
```

示例：

```
tcp_output/session_20250127_103045.txt
```

**保存时机**:

- 点击 "保存" 按钮时
- 停止服务器时自动保存
- 达到最大缓存条数时自动保存（默认 1000 条）

---

### 3. 客户端连接区域

```
┌──────────────────────────────────────────────────────┐
│ 客户端连接                                            │
│ 当前连接: 2 个                                        │
├──────────────────────────────────────────────────────┤
│ 客户端地址      | 连接时间      | 报文数 | 状态      │
│ 192.168.1.10  | 10:30:45      | 523    | ● 在线    │
│ 192.168.1.11  | 10:31:20      | 189    | ● 在线    │
└──────────────────────────────────────────────────────┘
```

#### 客户端信息

| 字段 | 说明 |
|------|------|
| **客户端地址** | 客户端的 IP 地址和端口（如 `192.168.1.10:54321`） |
| **连接时间** | 客户端连接到服务器的时间 |
| **报文数** | 该客户端发送的报文总数 |
| **状态** | ● 在线（绿色）/ ○ 离线（灰色） |

#### 客户端操作

**右键菜单**（在客户端列表中右键单击）:

```
┌──────────────────┐
│ 断开连接         │  ← 强制断开选中的客户端
│ 查看详情         │  ← 查看客户端的详细报文
│ 刷新列表         │  ← 刷新客户端状态
└──────────────────┘
```

---

### 4. 统计信息区域

```
┌──────────────────────────────────────────────────────┐
│ 统计信息                                              │
│ ┌─────────────────┬─────────────────┬──────────────┐ │
│ │ 总接收: 1,523   │ 成功: 1,500     │ 失败: 23     │ │
│ │ 会话: #1        │ 开始: 10:30:45  │ 运行: 05:23  │ │
│ └─────────────────┴─────────────────┴──────────────┘ │
└──────────────────────────────────────────────────────┘
```

#### 统计指标

| 指标 | 说明 | 更新频率 |
|------|------|---------|
| **总接收** | 接收到的报文总数 | 实时 |
| **成功** | 成功解析的报文数 | 实时 |
| **失败** | 解析失败的报文数 | 实时 |
| **会话** | 当前会话编号 | 启动时 |
| **开始时间** | 服务器启动时间 | 启动时 |
| **运行时间** | 服务器已运行的时间 | 每秒 |

#### 成功率计算

```
成功率 = 成功数 / 总接收数 × 100%
```

示例：

```
成功率 = 1500 / 1523 × 100% = 98.49%
```

---

### 5. 日志输出区域（底部）

#### 日志内容

实时显示服务器运行日志：

```
[INFO] TCP 服务器已启动: 0.0.0.0:9999
[INFO] 使用协议: sinexcel
[INFO] 等待客户端连接...
[INFO] [192.168.1.10:54321] 客户端已连接
[INFO] [192.168.1.10] 收到报文: 15 字节
[SUCCESS] [192.168.1.10] 解析成功: 命令码 0x01 (应答)
[WARNING] [192.168.1.10] 报文长度不足，已跳过
[ERROR] [192.168.1.11] 解析失败: 命令码 0xFF 未定义
[INFO] [192.168.1.10] 客户端已断开
```

#### 日志格式

- `[级别] [客户端地址] 消息内容`
- 客户端地址仅在必要时显示
- 使用颜色区分不同级别（INFO=蓝色、SUCCESS=绿色、WARNING=橙色、ERROR=红色）

#### 右键菜单

```
┌──────────────────┐
│ 清空日志         │  ← 清空所有日志
│ 全选             │  ← 选择所有日志文本
│ 复制             │  ← 复制选中的文本
│ 另存为...        │  ← 将日志保存到文件
└──────────────────┘
```

---

## 🎨 界面风格设置

V8Parse GUI 支持亮色和暗色两种主题风格。

### 切换方法

**方法 1**: 菜单栏切换

1. 点击菜单栏 `视图(V)` → `界面风格`
2. 选择 `亮色主题` 或 `暗色主题`

**方法 2**: 快捷键切换

- `Ctrl+L`: 切换到亮色主题
- `Ctrl+D`: 切换到暗色主题

### 主题特性

#### 亮色主题

- **背景**: 浅灰色（`#f5f5f5`）
- **前景**: 深色文字（`#2c3e50`）
- **强调色**: 蓝色（`#3498db`）
- **边框**: 中灰色（`#bdc3c7`）
- **适用场景**: 白天使用、打印友好

#### 暗色主题（默认）

- **背景**: 深灰色（`#2b2b2b`）
- **前景**: 浅色文字（`e0e0e0`）
- **强调色**: 亮蓝色（`#4db8ff`）
- **边框**: 深灰色（`#404040`）
- **适用场景**: 夜间使用、长时间工作

### 主题记忆

程序会自动记住最后使用的主题，下次启动时自动恢复。

**保存位置**:

- **Windows**: `HKEY_CURRENT_USER\Software\V8Parse\UnifiedGUI`
- **macOS**: `~/Library/Preferences/com.V8Parse.UnifiedGUI.plist`
- **Linux**: `~/.config/V8Parse/UnifiedGUI.conf`

---

## ❓ 常见问题

### Q1: 启动程序时提示 "缺少必要的依赖库"

**原因**: 未安装 GUI 所需的第三方库

**解决方法**:

```bash
pip install -r requirements-gui.txt
```

或手动安装：

```bash
pip install PySide6 PyYAML
```

---

### Q2: 协议列表为空

**原因**: `configs/` 目录下没有协议配置文件

**解决方法**:

1. 检查 `configs/` 目录是否存在
2. 确保每个协议目录下有 `protocol.yaml` 文件
3. 尝试运行 `python main.py --validate` 验证配置

---

### Q3: 选择日志文件后提示 "文件不存在或为空"

**原因**: 日志文件不存在或大小为 0

**解决方法**:

1. 检查文件路径是否正确
2. 确认文件大小 > 0 字节
3. 检查文件权限（是否有读取权限）

---

### Q4: 解析时提示 "配置验证失败"

**原因**: YAML 配置文件存在语法或语义错误

**解决方法**:

1. 点击 "验证配置" 按钮查看详细错误信息
2. 检查 YAML 缩进（使用空格，不要用 Tab）
3. 确认所有字段引用都已定义
4. 运行 `python src/validate_configs.py configs/<protocol>/protocol.yaml` 详细验证

---

### Q5: TCP 服务器启动失败，提示 "端口已被占用"

**原因**: 指定的端口已被其他程序使用

**解决方法**:

**Windows**:

```cmd
netstat -ano | findstr :9999
taskkill /PID <进程ID> /F
```

**Linux/macOS**:

```bash
lsof -i :9999
kill -9 <进程ID>
```

或更换端口号（如 9998、10000）

---

### Q6: 时间选择器无法选择精确到秒

**原因**: 日历选择器默认只显示到分钟

**解决方法**:

1. 在日历选择器下方找到时间微调框
2. 使用上下箭头调整小时、分钟、秒
3. 或手动输入数字

---

### Q7: 解析结果文件乱码

**原因**: 日志文件编码与系统默认编码不一致

**解决方法**:

1. 将日志文件转换为 UTF-8 编码
2. 或使用 Notepad++ 等工具另存为 UTF-8 格式

---

### Q8: GUI 界面显示异常（字体错位、按钮重叠）

**原因**: 系统 DPI 设置不正确

**解决方法**:

**Windows**:

1. 右键桌面 → 显示设置
2. 缩放比例设置为 100% 或 125%
3. 重启程序

或设置环境变量：

```bash
set QT_AUTO_SCREEN_SCALE_FACTOR=1
python main_gui.py
```

---

### Q9: 如何批量解析多个日志文件？

**方法**: 使用命令行版本 `main.py`

```bash
python main.py sinexcel
python main.py v8
python main.py xiaoju
```

或编写批处理脚本（Windows）：

```batch
@echo off
python main.py sinexcel
python main.py v8
python main.py xiaoju
pause
```

---

### Q10: 解析速度慢，如何优化？

**优化方法**:

1. **启用命令过滤**: 只解析需要的命令
2. **启用时间过滤**: 缩小解析时间范围
3. **关闭实时日志**: 减少日志输出（修改代码）
4. **使用 SSD**: 将日志文件放在固态硬盘上
5. **增加内存**: 确保系统有足够可用内存

---

## 🔧 高级功能

### 1. 拖拽文件到协议列表

**功能**: 直接拖拽日志文件到协议列表，自动关联到对应协议

**使用步骤**:

1. 在资源管理器中找到日志文件（如 `sinexcel.log`）
2. 拖拽文件到协议列表的 `sinexcel` 协议项上
3. 松开鼠标，日志自动关联

**提示**:

- 文件名必须与协议名匹配（忽略扩展名）
- 拖拽到错误协议会自动纠正

---

### 2. 快捷键大全

| 快捷键 | 功能 | 作用范围 |
|--------|------|---------|
| `Ctrl+Q` | 退出程序 | 全局 |
| `Ctrl+1` | 切换到普通解析页面 | 全局 |
| `Ctrl+2` | 切换到 TCP 服务端页面 | 全局 |
| `Ctrl+Tab` | 顺序切换页面 | 全局 |
| `Ctrl+L` | 切换到亮色主题 | 全局 |
| `Ctrl+D` | 切换到暗色主题 | 全局 |
| `Ctrl+A` | 全选 | 日志面板 |
| `Ctrl+C` | 复制 | 日志面板 |
| `Ctrl+D` | 清空日志 | 日志面板 |
| `ESC` | 关闭对话框 | 全局 |
| `F5` | 刷新 | 客户端列表 |

---

### 3. 自动保存会话状态

**功能**: 程序退出时自动保存状态，下次启动时恢复

**保存的内容**:

- 最后打开的页面（普通解析 / TCP 服务端）
- 每个协议最后使用的日志文件路径
- 窗口位置和大小
- 界面主题（亮色/暗色）

**清除设置**:

```bash
# Windows
reg delete "HKCU\Software\V8Parse\UnifiedGUI" /f

# Linux
rm -rf ~/.config/V8Parse/

# macOS
rm ~/Library/Preferences/com.V8Parse.UnifiedGUI.plist
```

---

### 4. 配置文件热重载

**功能**: 修改 YAML 配置后自动重新加载，无需重启程序

**使用方法**:

1. 修改 `configs/<protocol>/protocol.yaml`
2. 在 GUI 中点击 "验证配置" 按钮
3. 配置自动重新加载

**提示**: 修改配置后建议先验证，确认无误后再开始解析

---

### 5. 自定义日志输出格式

**位置**: `src/yaml_unified_protocol.py`

**修改方法**:

1. 打开 `yaml_unified_protocol.py`
2. 找到 `format_log_entry()` 方法
3. 修改输出格式（添加、删除、重排字段）
4. 保存文件，无需重启程序

**示例**:

```python
def format_log_entry(self, entry: LogEntry) -> str:
    """自定义输出格式"""
    lines = [
        f"时间: {entry.timestamp}",
        f"方向: {entry.direction}",
        f"命令: {entry.cmd_id} ({entry.cmd_name})",
        f"数据: {entry.raw_data}",
        "--- 解析结果 ---"
    ]
    for field_name, field_value in entry.parsed_fields.items():
        lines.append(f"  {field_name}: {field_value}")
    return "\n".join(lines)
```

---

### 6. 添加新协议（GUI 操作）

虽然添加新协议主要通过创建 YAML 配置文件，但 GUI 可以帮助验证配置：

**步骤**:

1. **创建配置文件**: 在 `configs/new_protocol/` 下创建 `protocol.yaml`
2. **验证配置**: 启动 GUI，协议列表会自动显示新协议
3. **检查状态**: 查看配置状态是否为 "✅ 验证通过"
4. **选择日志**: 点击 "📂 选择" 选择测试日志文件
5. **测试解析**: 点击 "开始解析" 测试配置是否正确

**快速生成配置模板**:

```bash
python tools/generate_config_template.py > configs/new_protocol/protocol.yaml
```

---

## 📞 技术支持

### 反馈问题

如果遇到程序 Bug 或有功能建议，请通过以下方式反馈：

- **GitHub Issues**: [项目地址]
- **邮件支持**: <support@v8parse.com>
- **文档**: 查看 `README.md` 和 `CLAUDE.md`

### 日志收集

为便于排查问题，请提供以下信息：

1. **程序版本**: 查看 "帮助" → "关于"
2. **操作系统**: Windows / macOS / Linux 版本号
3. **错误截图**: 截图错误信息和界面状态
4. **日志文件**: `parsed_log/` 目录下的输出文件
5. **配置文件**: `configs/<protocol>/protocol.yaml`

---

## 📜 附录

### A. 协议配置示例

详见 `configs/` 目录下的各协议配置文件：

- `configs/v8/protocol.yaml` - V8 协议
- `configs/sinexcel/protocol.yaml` - Sinexcel 协议
- `configs/xiaoju/protocol.yaml` - 小桔协议
- `configs/yunwei/protocol.yaml` - 运维协议
- `configs/yunkuaichong/protocol.yaml` - 云快充协议

### B. 日志文件示例

详见 `input_logs/` 目录：

- `input_logs/v8.log` - V8 协议日志示例
- `input_logs/sinexcel.log` - Sinexcel 协议日志示例

### C. 解析结果示例

详见 `parsed_log/` 目录：

- `parsed_v8_log_*.txt` - V8 协议解析结果
- `parsed_sinexcel_log_*.txt` - Sinexcel 协议解析结果

### D. 相关文档

- `README.md` - 项目总体介绍
- `CLAUDE.md` - 开发者指南
- `build_gui.py` - GUI 打包脚本

---

**版本历史**:

- **v1.0.0** (2025-01-27): 初始版本，包含普通解析和 TCP 服务端功能

---

*本文档由 V8Parse 团队维护 | 最后更新: 2025-01-27*
